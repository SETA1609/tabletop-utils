{% load i18n %}
{% if current_turn %}
    <div class="alert alert-info">{% trans "Current Turn" %}: {{ current_turn.name }} (Init: {{ current_turn.initiative }})</div>
{% else %}
    <div class="alert alert-warning">{% trans "No characters added yet!" %}</div>
{% endif %}
<div class="mb-3">
    <a
        href="{% url 'initiative_tracker:add_character' %}"
        hx-get="{% url 'initiative_tracker:add_character' %}"
        hx-target="#add-form"
        hx-swap="innerHTML"
        class="btn btn-primary"
    >
        {% trans "Add Character" %}
    </a>
    {% if characters %}
        <form method="post" action="{% url 'initiative_tracker:next_turn' %}" class="d-inline ms-2" hx-post="{% url 'initiative_tracker:next_turn' %}" hx-target="#tracker-content" hx-swap="innerHTML">
            {% csrf_token %}
            <input type="hidden" name="action" value="next_turn">
            <input type="hidden" name="current_pk" value="{{ current_turn.pk }}">
            <button type="submit" class="btn btn-success">{% trans "Next Turn" %}</button>
        </form>
    {% endif %}
</div>
<table id="char-table" class="table table-striped">
    <thead><tr><th>{% trans "Name" %}</th><th>{% trans "Initiative" %}</th><th class="position-col">{% trans "Position" %}</th><th>{% trans "Actions" %}</th></tr></thead>
    <tbody>
        {% for char in characters %}
        <tr>
            <td>{{ char.name }}</td>
            <td>{{ char.initiative }}</td>
            <td>
                <div class="btn-group btn-group-sm" role="group">
                    <form method="post" action="{% url 'initiative_tracker:reorder' %}" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="reorder_decrease">
                        <input type="hidden" name="pk" value="{{ char.pk }}">
                        <button type="submit" class="btn btn-outline-secondary" title="{% trans 'Decrease position' %}">
                            <i class="fas fa-minus"></i>
                        </button>
                    </form>
                    <span class="btn btn-sm btn-outline-secondary disabled px-3 position-display">{{ char.position }}</span>
                    <form method="post" action="{% url 'initiative_tracker:reorder' %}" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="reorder_increase">
                        <input type="hidden" name="pk" value="{{ char.pk }}">
                        <button type="submit" class="btn btn-outline-secondary" title="{% trans 'Increase position' %}">
                            <i class="fas fa-plus"></i>
                        </button>
                    </form>
                </div>
            </td>
            <td>
                <form method="post" action="{% url 'initiative_tracker:delete_character' char.pk %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-danger" title="{% trans 'Delete character' %}">
                        <i class="fas fa-trash"></i> {% trans "Delete" %}
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<div id="add-form"></div>  <!-- Inline add form target -->
